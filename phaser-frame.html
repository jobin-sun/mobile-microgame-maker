<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <style>
    html, body {
      margin: 0;
    }
    </style>
    <link rel="stylesheet" href="assets/fonts/FredokaOne.css">
    <title>Phaser Frame</title>
    <script src="vendor/phaser.js"></script>
    <script>
    // Safari doesn't cache audio offline, even if the data is tiny.
    // We'll work around this annoyance by monkeypatching 
    // Phaser to ensure that we always access the network for audio data,
    // if we're online. If we're offline, audio simply won't work,
    // which is better than the entire app not working at all.
    //
    // For more information on this issue, see:
    //
    // https://github.com/toolness/mobile-microgame-maker/issues/7
    function bypassSafariAppCacheLameness() {
      var usingManifest = false;
      var LoaderProto = Phaser.Loader.prototype;
      var ua = navigator.userAgent;
      var isSafari = /safari/i.test(ua) && !/chrome/i.test(ua);

      try {
        usingManifest = window.top.document.documentElement
          .hasAttribute('manifest');
      } catch (e) {}

      if (!usingManifest || !isSafari || LoaderProto.originalXhrLoad)
        return;

      LoaderProto.originalXhrLoad = LoaderProto.xhrLoad;
      LoaderProto.xhrLoad = function(index, url, type, onload, onerror) {
        if (navigator.onLine)
          url = url + '?cacheBust=' + Date.now();
        return this.originalXhrLoad(index, url, type, onload, onerror);
      };
    }

    bypassSafariAppCacheLameness();
    </script>
  </head>
  <body>
    <span style="font-family: 'Fredoka One'; position: absolute; top: 0; left: 0; visibility: hidden; pointer-events: none">
      This text is just here to (hopefully) ensure that the browser
      actually loads Fredoka One before triggering onload.
    </span>
  </body>
</html>
